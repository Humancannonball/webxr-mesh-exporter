<VirtualHost *:80>
    ServerName localhost
    DocumentRoot /opt/bitnami/projects/webxr-mesh-exporter
    
    # Proxy WebSocket connections
    ProxyPreserveHost On
    ProxyRequests Off
    
    # WebSocket proxy
    ProxyPass /socket.io/ ws://localhost:3000/socket.io/
    ProxyPassReverse /socket.io/ ws://localhost:3000/socket.io/
    
    # HTTP proxy for everything else
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
    
    # Enable WebSocket upgrade
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://localhost:3000/$1" [P,L]
    
    ErrorLog /opt/bitnami/apache/logs/webxr_error.log
    CustomLog /opt/bitnami/apache/logs/webxr_access.log combined
</VirtualHost>

<VirtualHost *:443>
    ServerName localhost
    DocumentRoot /opt/bitnami/projects/webxr-mesh-exporter
    
    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /opt/bitnami/apache/conf/bitnami/certs/server.crt
    SSLCertificateKeyFile /opt/bitnami/apache/conf/bitnami/certs/server.key
    
    # Proxy WebSocket connections
    ProxyPreserveHost On
    ProxyRequests Off
    
    # WebSocket proxy
    ProxyPass /socket.io/ ws://localhost:3000/socket.io/
    ProxyPassReverse /socket.io/ ws://localhost:3000/socket.io/
    
    # HTTP proxy for everything else
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
    
    # Enable WebSocket upgrade
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://localhost:3000/$1" [P,L]
    
    ErrorLog /opt/bitnami/apache/logs/webxr_ssl_error.log
    CustomLog /opt/bitnami/apache/logs/webxr_ssl_access.log combined
</VirtualHost>
